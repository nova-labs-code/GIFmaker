<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working GIF Maker</title>
<style>
body { font-family: sans-serif; text-align: center; margin-top: 20px; }
canvas { display: none; }
#gifPreview { margin-top: 20px; max-width: 500px; }
select, button { margin: 10px; padding: 5px; }
</style>
</head>
<body>

<h1>GIF Maker with Effects + Transitions</h1>

<input type="file" id="imageUpload" multiple accept="image/*"><br>

<label for="effectSelect">Effect:</label>
<select id="effectSelect">
  <option value="fade">Fade</option>
  <option value="slide">Slide</option>
  <option value="scale">Scale</option>
  <option value="rotate">Rotate</option>
</select>

<label for="transitionSelect">Transition:</label>
<select id="transitionSelect">
  <option value="none">None</option>
  <option value="crossfade">Crossfade</option>
  <option value="zoom">Zoom</option>
  <option value="spin">Spin</option>
</select>

<br>
<button id="generateBtn">Generate GIF</button>

<canvas id="canvas" width="500" height="500"></canvas>
<img id="gifPreview" alt="Your GIF will appear here">
<br>
<a id="downloadLink" download="animation.gif">Download GIF</a>

<script src="https://cdn.jsdelivr.net/npm/gif.js/dist/gif.js"></script>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const gifPreview = document.getElementById('gifPreview');
let files = [];

document.getElementById('imageUpload').addEventListener('change', e => {
    files = Array.from(e.target.files);
});

function loadImages(files) {
    return Promise.all(files.map(file => new Promise(resolve => {
        const img = new Image();
        img.src = URL.createObjectURL(file);
        img.onload = () => resolve(img);
    })));
}

// Draw a single frame with effect + transition
function drawFrame(ctx, img, effect, transition, progress, prevImg=null) {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Crossfade previous image if needed
    if (transition === 'crossfade' && prevImg) {
        ctx.globalAlpha = 1 - progress;
        ctx.drawImage(prevImg, 0, 0, canvas.width, canvas.height);
    }

    ctx.globalAlpha = 1;

    // Compute effect
    let x=0, y=0, w=canvas.width, h=canvas.height;
    let rotation=0, scale=1;

    if (effect === 'fade') {
        ctx.globalAlpha = progress;
    } else if (effect === 'slide') {
        x = progress * canvas.width;
    } else if (effect === 'scale') {
        scale = 0.5 + progress * 0.5;
        w = canvas.width * scale;
        h = canvas.height * scale;
        x = canvas.width/2 - w/2;
        y = canvas.height/2 - h/2;
    } else if (effect === 'rotate') {
        rotation = progress * 2 * Math.PI;
    }

    ctx.save();
    ctx.translate(canvas.width/2, canvas.height/2);
    ctx.rotate(rotation);
    if (transition === 'spin') ctx.rotate(progress * 2 * Math.PI);
    if (transition === 'zoom') scale = scale * (0.5 + 0.5 * progress);

    ctx.drawImage(img, -canvas.width/2 + x, -canvas.height/2 + y, w, h);
    ctx.restore();
}

document.getElementById('generateBtn').addEventListener('click', async () => {
    if (files.length === 0) return alert("Upload images first!");
    const images = await loadImages(files);
    const effect = document.getElementById('effectSelect').value;
    const transition = document.getElementById('transitionSelect').value;
    const gif = new GIF({ workers:2, quality:10, width:canvas.width, height:canvas.height });
    const framesPerImage = 15;

    for (let i=0; i<images.length; i++) {
        const img = images[i];
        const prevImg = i>0 ? images[i-1] : null;

        for (let f=0; f<framesPerImage; f++) {
            const progress = f/framesPerImage;
            drawFrame(ctx, img, effect, transition, progress, prevImg);
            gif.addFrame(ctx, {copy:true, delay:100});
        }
    }

    gif.on('finished', blob => {
        const url = URL.createObjectURL(blob);
        gifPreview.src = url;
        document.getElementById('downloadLink').href = url;
    });

    gif.render();
});
</script>
</body>
</html>